from machine import Pin, SPI
from st7735.ST7735 import TFT
from st7735.sysfont import sysfont
import time
import image_data

# TFT_CLK =   const(34)
# TFT_MOSI =  const(35)
# TFT_DC =    const(33)
# TFT_RST =   const(32)
# TFT_CS =    const(25)
# 定义TFT屏幕的引脚
TFT_CLK = 18   # SCL (SCLK)
TFT_MOSI = 23  # SDA (MOSI)
TFT_DC = 2     # DC
TFT_RST = 4    # RST
TFT_CS = 5     # CS

# 初始化SPI
spi = SPI(2, baudrate=20000000, polarity=0, phase=0, sck=Pin(TFT_CLK), mosi=Pin(TFT_MOSI))

# 初始化TFT
tft = TFT(spi, TFT_DC, TFT_RST, TFT_CS)

# 初始化显示
tft.initr()
tft.rgb(True)

# 清屏并设置旋转
tft.fill(TFT.BLACK)
tft.rotation(1)

# 显示文本
def show_text():
    tft.text((0, 0), "Hello, ESP32!", TFT.WHITE, sysfont, 2)
    tft.text((0, 20), "TFT Display", TFT.GREEN, sysfont, 2)
    tft.text((0, 40), "Test", TFT.RED, sysfont, 2)

# 显示一些图形
def show_graphics():
    tft.fill(TFT.BLACK)
    tft.line((0, 0), (tft.size()[0]-1, tft.size()[1]-1), TFT.WHITE)
    tft.rect((10, 10), (50, 50), TFT.BLUE)
    tft.fillrect((70, 10), (50, 50), TFT.RED)
    tft.circle((32, 100), 30, TFT.YELLOW)
    tft.fillcircle((96, 100), 30, TFT.CYAN)


def show_image():
    tft.fill(TFT.BLACK)
    # 将元组转换为字节数组
    image_bytes = bytes([
        0x00, 0x00, 0x00, 0x00, 0x01, 0x80, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x07, 0xe0, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x1f, 0xf8, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x3f, 0xfc, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x7f, 0xfe, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x01, 0xff, 0xff, 0x80, 0x00,
        0x00, 0x00, 0x00, 0x03, 0xff, 0xff, 0xc0, 0x00,
        0x00, 0x00, 0x00, 0x07, 0xff, 0xff, 0xe0, 0x00,
        0x00, 0x00, 0x00, 0x0f, 0xff, 0xff, 0xf0, 0x00,
        0x00, 0x00, 0x00, 0x1f, 0xff, 0xff, 0xf8, 0x00,
        0x00, 0x00, 0x00, 0x3f, 0xff, 0xff, 0xfc, 0x00,
        0x00, 0x00, 0x00, 0x7f, 0xff, 0xff, 0xfe, 0x00,
        0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00,
        0x00, 0x00, 0x01, 0xff, 0xff, 0xff, 0xff, 0x80
    ])
    tft.image(0, 0, tft.size()[0]-1, tft.size()[1]-1, image_bytes)


# 主循环
def main():
    while True:
        show_text()
        time.sleep(2)
        show_graphics()
        time.sleep(2)
        show_image()
        time.sleep(2)
        tft.fill(TFT.BLACK)

main()
# if __name__ == "__main__":
#     main()
